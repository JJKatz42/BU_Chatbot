<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BUsearch</title>
    <style>
        @import url("https://use.typekit.net/edk5oho.css");
        .sidebar {
            display: none;
        }
        
        .chat-space {
            margin-left: 0 !important;
        }
        
        .chat-input-container {
            left: 0 !important;
            align-self: center !important;
            width: calc(100% - 78px) !important;
        }
        
        .toggle-button.working-version {
            position: relative !important;
            bottom: 0 !important;
            left: 0 !important;
            transform: none !important;
            background-color: transparent !important;
        }
        
        .navbar-menu a {
            transform: translate(0, 5px);
        }
        
        span.background {
            background-color: #aa0000;
            border-radius: 5px;
            padding: 5px;
        }
        
         :root {
            --bu-red: #CC0000;
            --black: #2D2926;
            --white: #ffffff;
            --light-gray: #f2f2f2;
            --dark-gray: #333;
            --BUsearch-response: #e0e0e0;
            --monospace: "coordinates-variable", serif;
            --sans: aktiv-grotesk, sans-serif;
            --serif: freight-display-pro, 'Times New Roman', serif;
            --button-size: 15px;
            --text-size: 15px;
        }
        /* Hide scrollbar for Chrome, Safari and Opera */
        
        .chat-space-container::-webkit-scrollbar {
            display: none !important;
        }
        /* Hide scrollbar for IE, Edge and Firefox */
        
        .chat-space-container {
            -ms-overflow-style: none;
            /* IE and Edge */
            scrollbar-width: none;
            /* Firefox */
        }
        
        body {
            margin: 0;
            padding: 0;
            font-family: var(--sans-serif-font);
            background-color: var(--white);
        }
        
        a {
            text-decoration: none;
            color: inherit;
        }
        
        button,
        a {
            font-size: var(--button-size);
        }
        
        .chat-response,
        .chat-input {
            font-size: var(--text-size);
        }
        
        .navbar {
            background-color: var(--bu-red);
            color: var(--white);
            font-family: var(--monospace);
            font-weight: bold;
            position: fixed;
            top: 0;
            width: 100%;
            height: 60px;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            box-shadow: 0px 0.1px 10px 0px black;
        }
        
        .navbar-container {
            max-width: 1200px;
            width: 100%;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .navbar-menu {
            display: flex;
            gap: 20px;
        }
        
        .navbar-menu *:hover {
            opacity: 0.8;
        }
        
        .sidebar {
            background-color: var(--black);
            color: var(--white);
            position: fixed;
            top: 60px;
            left: 0;
            width: 250px;
            height: calc(100% - 60px);
            padding: 30px;
            box-sizing: border-box;
            overflow-y: auto;
            font-family: var(--monospace);
            font-weight: bold;
        }
        
        .chat-space {
            margin-left: 250px;
            padding-top: 60px;
            height: calc(100vh - 100px);
            display: flex;
            flex-direction: column-reverse;
            padding: 20px;
            box-sizing: border-box;
            margin-top: 60px;
            justify-content: flex-end;
        }
        
        .chat-space-container {
            overflow-y: auto;
            margin-bottom: 60px;
            display: flex;
            flex-direction: column-reverse;
        }
        
        .chat-input-container {
            display: flex;
            gap: 10px;
            align-items: center;
            position: fixed;
            bottom: 20px;
            margin: 34px;
            left: 250px;
            width: calc(100% - 330px);
            box-sizing: border-box;
            background-color: var(--white);
            justify-content: center;
        }
        
        .chat-input {
            flex: 1;
            padding: 15px;
            box-sizing: border-box;
            background-color: var(--BUsearch-response);
            border: none;
            border-radius: 5px;
            outline: none;
            max-width: 890px;
            margin-left: 13px;
        }
        
        @media only screen and (max-width: 1030px) {
            .chat-input-container {
                width: 100%
            }
        }
        
        .send-button {
            background-color: var(--bu-red);
            color: var(--white);
            font-family: var(--monospace-font);
            font-weight: bold;
            border: none;
            padding: 5px;
            cursor: pointer;
            text-transform: lowercase;
            border-radius: 5px;
        }
        
        .chat-response {
            background-color: var(--BUsearch-response);
            padding: 20px;
            margin: 10px auto;
            border-radius: 5px;
            word-wrap: break-word;
            text-align: left;
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 600px;
        }
        
        .chat-input {
            max-width: 585px;
        }
        
        .chat-response {
            font-family: var(--sans);
        }
        
        @media only screen and (max-width: 1030px) {
            .chat-response {
                width: 100%
            }
            .chat-input {
                max-width: 100%;
            }
        }
        
        .chat-response.input {
            background-color: var(--white);
            color: var(--dark-gray);
        }
        
        .dark-mode {
            background-color: var(--dark-gray);
            color: var(--white);
        }
        
        .dark-mode .settings-content-container {
            color: var(--white);
        }
        
        .dark-mode .chat-response {
            background-color: #555;
        }
        
        .dark-mode .chat-response.input {
            background-color: var(--dark-gray);
            color: var(--white);
        }
        
        .dark-mode .chat-input {
            background-color: #555;
            color: var(--white);
            outline: none;
        }
        
        .dark-mode .chat-input::placeholder {
            color: lightgray;
        }
        
        .dark-mode .chat-input-container {
            background-color: var(--dark-gray);
        }
        
        .toggle-button {
            font-family: var(--monospace-font);
            font-weight: bold;
            text-transform: lowercase;
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--black);
            color: var(--white);
            border: none;
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 5px;
        }
        
        .toggle-button:hover {
            background-color: var(--dark-gray);
        }
        
        .settings-popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80%;
            height: 80%;
            z-index: 2000;
            border-radius: 10px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
            background-color: var(--white);
        }
        
        .settings-sidebar {
            background-color: var(--black);
            color: var(--white);
            width: 250px;
            height: 100%;
            float: left;
            padding: 40px;
            padding-top: 60px;
            padding-bottom: 60px;
            box-sizing: border-box;
            overflow-y: auto;
            font-family: var(--monospace);
            font-weight: bold;
            border-radius: 10px;
            border-top-right-radius: 0px;
            border-bottom-right-radius: 0px;
        }
        
        .settings-content-container {
            padding: 40px;
            padding-top: 60px;
            padding-bottom: 60px;
            box-sizing: border-box;
            overflow-y: auto;
            font-family: var(--sans);
            height: calc(100% - 60px);
            position: relative;
            color: var(--black);
        }
        
        .settings-sidebar-tab,
        .sidebar-tab {
            padding: 10px;
            margin-bottom: 14px;
            border-radius: 10px;
        }
        
        .settings-sidebar-tab a,
        .sidebar-tab a {
            display: block;
        }
        
        .settings-sidebar-tab:hover,
        .sidebar-tab:hover {
            background-color: var(--dark-gray);
        }
        
        .dark-mode .settings-popup {
            background-color: var(--dark-gray);
        }
        
        .light-mode .settings-popup {
            background-color: var(--light-gray);
        }
        
        .settings-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background-color: gray;
            color: var(--white);
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            border-radius: 5px;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0px 0px 5px rgba(0, 0, 0, 0.1);
            z-index: 99;
        }
        
        .settings-close:hover {
            background-color: rgb(112, 112, 112);
        }
        
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1500;
        }
        
        .save-button,
        .cancel-button {
            position: fixed;
            bottom: 20px;
            background-color: var(--bu-red);
            color: var(--white);
            font-family: var(--monospace-font);
            font-weight: bold;
            border: none;
            padding: 10px;
            cursor: pointer;
            text-transform: lowercase;
            border-radius: 5px;
        }
        
        .cancel-button {
            right: 84px;
            background-color: gray;
        }
        
        .cancel-button:hover {
            background-color: rgb(112, 112, 112);
        }
        
        .save-button {
            right: 20px;
        }
        
        .save-button:hover {
            background-color: #aa0000;
        }
        
        .icon-div {
            position: absolute;
            left: -60px;
            /* Adjust as needed */
            top: 50%;
            transform: translateY(-50%);
            width: auto;
            max-height: 54px;
            background-color: var(--dark-gray);
        }
        
        .BUsearch-icon {
            background-image: url('bot.png');
        }
        
        .human-icon {
            background-image: url('user.png');
        }
        
        .chat-response {
            /* Existing styles */
            /* ... */
            display: flex;
            align-items: center;
        }
        
        .send-button::before {
            content: "";
            background-image: url('send.png');
            background-size: cover;
            display: inline-block;
            width: 75%;
            height: 75%;
            filter: invert(1);
            margin-bottom: -3px;
        }
        
        .send-button {
            width: 45px;
            height: 45px;
            padding: 12px;
        }
        
        .likeBtn,
        .dislikeBtn {
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            width: 30px;
            height: 30px;
            border: 6px;
            margin-bottom: 5px;
            background-size: 16px;
            background-repeat: no-repeat;
            background-position: center;
            width: 30px;
            height: 30px;
            /* border: 6px; */
            margin-bottom: 5px;
        }
        
        .likeBtn {
            background-image: url('like.png');
        }
        
        .dislikeBtn {
            background-image: url('dislike.png');
        }
        
        .chat-response.welcome {
            display: block;
            background-color: transparent;
            text-align: center;
        }
        
        title {
            display: block;
            font-size: 40px;
            font-family: var(--serif);
            font-weight: normal;
        }
        
        title.overlay-title {
            font-size: 400px;
            position: absolute;
            z-index: -1;
            opacity: 0.2;
            font-family: var(--serif);
            transform: translate(-80px, -140px);
        }
        
        p.welcome-text {
            display: block;
            font-family: var(--sans);
        }
        
        .flex-box.spread {
            display: flex;
            justify-content: space-between;
        }
        
        .feedback-buttons {
            /* width: 285px; */
            position: inherit;
            margin-left: 10px;
            /* margin-right: -20px; */
        }
        
        button:hover {
            opacity: 0.8;
        }
        
        .feedback-buttons button {
            border-radius: 5px;
        }
        
        .feedback-buttons button:hover {
            opacity: 0.4 !important;
        }
        
        .feedback-buttons button.active {
            background-color: #CC0000;
        }
        
        .likeBtn.active {
            background-image: url(like-white.png) !important;
        }
        
        .dislikeBtn.active {
            background-image: url(dislike-white.png) !important;
        }
    </style>
</head>












































<body>
    <div class="navbar">
        <div class="navbar-container">
            <div>BUsearch.com <span class="background">BETA</span></div>
            <div class="navbar-menu">
                <a href="#" id="loginBtn">login</a>
                <a href="#">chat</a>
                <a href="#" onclick="openSettings('about')">about</a>
                <a href="#" onclick="openSettings('contact')">contact</a>
                <button class="toggle-button working-version" onclick="toggleDarkMode()">toggle dark/light mode</button>
            </div>
        </div>
    </div>

    <div class="sidebar">
        <div class="sidebar-tab"><a href="#">Current Chat</a></div>
        <!-- <button class="toggle-button" onclick="toggleDarkMode()">toggle dark/light mode</button> -->
    </div>

    <div class="chat-space">
        <div class="chat-space-container">
            <!-- Existing chat-response blocks will be dynamically generated -->
            <div class="chat-response welcome input">
                <title>Welcome to BUsearch</title>
                <!-- <title class="overlay-title">Welcome</title> -->
                <p class="welcome-text">BUsearch is an informational chatbot for Boston University students.</p>
                <p class="welcome-text">To start searching, please <strong>log in using your BU email account</strong> above.</p>
            </div>
        </div>
    </div>

    <div class="chat-input-container">
        <label for="chatInput"></label><input type="text" class="chat-input" placeholder="Type your question..." id="chatInput" onkeydown="handleEnter(event)">
        <button class="send-button" onclick="sendMessage()"></button>
    </div>

    <!-- Settings Popup -->
    <div class="settings-popup light-mode" id="settingsPopup">
        <button class="settings-close" onclick="closeSettings()">&times;</button>
        <div class="settings-sidebar">
            <div class="settings-sidebar-tab" data-tab="about"><a href="#">about</a></div>
            <div class="settings-sidebar-tab" data-tab="contact"><a href="#">contact</a></div>
            <!-- Add more tabs as needed -->
        </div>
        <div class="settings-content-container">
            <div class="settings-content" data-content="about">
                <h3>About BUsearch</h3>
                <p>Welcome to BUsearch, the informational chatbot designed to make relevant university information instantly accessible, ensuring swift and concise answers for every Boston University student.</p>

                <h3>Our Mission</h3>
                <p>At BUsearch, our mission is to empower every student at Boston University with instant access to essential information, ensuring a seamless and enriched campus experience. We believe in harnessing the power of technology to bridge the
                    gap between students and the vast resources available at BU.</p>

                <h3>Our Product</h3>
                <p>BUsearch is an informational assistant custom-built for every BU studentâ€™s day-to-day needs. Whether you're a freshman trying to navigate your way around campus, a senior looking for graduation details, or an international student seeking
                    housing advice, BUsearch is here to assist.</p>

                <h3>Key Features</h3>
                <ul>
                    <li>Instant Answers: No more waiting for appointments or sifting through web pages. Get immediate responses to your questions in just seconds.</li>
                    <li>Comprehensive Database: From academic schedules to campus events, BUsearch covers a wide range of topics to cater to every student's needs.</li>
                    <li>Continuous Learning: BUsearch evolves with every interaction, ensuring that the information provided is always up-to-date and relevant.</li>
                    <li>Secure and Private: We prioritize your privacy. Rest assured, your interactions with BUsearch are confidential.</li>
                </ul>

                <h3>Our Team</h3>
                <p>We are a group of dedicated students across multiple universities, including Boston University, UC Berkeley, and Columbia, who are passionate about utilizing the newest technology to enhance the academic experience and streamline access
                    to essential resources for students everywhere, starting with Boston University.</p>

                <h3>Join Us</h3>
                <p>We believe in the power of collaboration. If you have suggestions, feedback, or want to be a part of the team, please reach out.</p>
            </div>
            <div class="settings-content" data-content="contact">
                <p>Drop us a line!</p>
                <p>busearchconnect@gmail.com</p>
            </div>
            <!-- Add more content sections as needed -->
            <!-- <button class="cancel-button" onclick="closeSettings()">cancel</button>
            <button class="save-button" onclick="closeSettings()">save</button> -->
        </div>
    </div>


    <!-- Background overlay -->
    <div class="overlay" id="overlay"></div>















































    <script>
        // Sample JWT Token for demonstration
        // const jwt_token = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6Impqa2F0ekBidS5lZHUifQ._PYi4cxWBGHa7cL90K4RNrDXC_AApqkbyCzfUwNfrx8';
        // const urlParams = new URLSearchParams(window.location.search);

        const API_BASE_URL = "https://busearch-wbtak2vipq-ue.a.run.app";

        let currentResponseID = null;

        document.getElementById('loginBtn').addEventListener('click', function() {
            // Start the OAuth2 flow by redirecting to the /login endpoint
            window.location.href = `${API_BASE_URL}/login`;
        });

        // Extract JWT token from URL if present
        const urlParams = new URLSearchParams(window.location.search);

        goodToStart = true // TODO: check if token is valid before setting goodToStart to true Use endpoint /is-authenticated (ask Jonah)

        function sendMessage() {
            let element = document.querySelector('.chat-response.welcome');
            element.style.display = 'none';

            const chatInput = document.getElementById('chatInput');
            const question = chatInput.value.trim();
            const sendButton = document.querySelector('button[onclick="sendMessage()"]');
            const chatSpace = document.querySelector('.chat-space-container');

            // Clear the chat input
            chatInput.value = '';

            // Disable the send button
            sendButton.disabled = true;

            // Create and show user's question in chat
            const userMsgDiv = document.createElement('div');
            userMsgDiv.className = 'chat-response input';
            userMsgDiv.textContent = "You: " + question;
            chatSpace.insertBefore(userMsgDiv, chatSpace.firstChild);

            // Create and show "thinking..." message from BUsearch
            const thinkingMsgDiv = document.createElement('div');
            thinkingMsgDiv.className = 'chat-response';
            thinkingMsgDiv.textContent = "BUsearch: thinking...";
            chatSpace.insertBefore(thinkingMsgDiv, chatSpace.firstChild);

            fetch(`${API_BASE_URL}/chat`, {
                    method: 'POST',
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        question: question
                    })
                })
                .then(response => {
                    if (!response.ok) {
                        return response.json().then(err => {
                            throw new Error(err.error || 'network problem.');
                        });
                    }
                    return response.json();
                })
                .then(data => {
                    currentResponseID = data.responseID;

                    // Replace "thinking..." with actual response
                    thinkingMsgDiv.innerHTML = "BUsearch: " + data.response; // Using innerHTML for HTML rendering
                    thinkingMsgDiv.id = currentResponseID; // Unique ID

                    // Create feedback buttons
                    const feedbackDiv = document.createElement('div');
                    feedbackDiv.className = 'feedback-buttons';
                    feedbackDiv.innerHTML = `
                        <button class="likeBtn" id="likeBtn-${currentResponseID}"></button>
                        <button class="dislikeBtn" id="dislikeBtn-${currentResponseID}"></button>
                    `;

                    // Append feedback buttons to the BUsearch response div
                    thinkingMsgDiv.appendChild(feedbackDiv);

                    // Attach event listeners to the newly created buttons
                    document.getElementById(`likeBtn-${currentResponseID}`).addEventListener('click', function() {
                        toggleActiveState(this, document.getElementById(`dislikeBtn-${currentResponseID}`));
                        sendFeedback(currentResponseID, true);
                    });

                    document.getElementById(`dislikeBtn-${currentResponseID}`).addEventListener('click', function() {
                        toggleActiveState(this, document.getElementById(`likeBtn-${currentResponseID}`));
                        sendFeedback(currentResponseID, false);
                    });
                })
                .catch(error => {
                    console.error('Error:', error);

                    // Replace "thinking..." with error message
                    thinkingMsgDiv.textContent = "BUsearch: I'm sorry there seems to be a connection problem. Please try to refresh the page or login again, using you BU gmail.";
                })
                .finally(() => {
                    // Re-enable the send button
                    sendButton.disabled = false;
                });
        }

        function openSettings(tab) {
            const settingsPopup = document.getElementById('settingsPopup');
            const overlay = document.getElementById('overlay');

            // Show the popup and overlay
            settingsPopup.style.display = 'block';
            overlay.style.display = 'block';

            // Switch to the tab specified in the argument
            if (tab) {
                switchSettingsContent(tab);
            }
        }

        function closeSettings() {
            const settingsPopup = document.getElementById('settingsPopup');
            const overlay = document.getElementById('overlay');
            settingsPopup.style.display = 'none';
            overlay.style.display = 'none';
        }

        function closeSettingsWithEsc(event) {
            if (event.key === 'Escape') {
                closeSettings();
            }
        }

        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
        }

        function handleEnter(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        function toggleActiveState(currentBtn, otherBtn) {
            if (currentBtn.classList.contains('active')) {
                currentBtn.classList.remove('active');
            } else {
                currentBtn.classList.add('active');
                otherBtn.classList.remove('active');
            }
        }

        /**
         * Send feedback to the server.
         * @param {string} responseID - The unique ID of the BUsearch's response.
         * @param {boolean} isLiked - The type of feedback, either true or false
         */
        function sendFeedback(responseID, isLiked) {

            fetch(`${API_BASE_URL}/feedback`, {
                    method: 'POST',
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        responseID: responseID,
                        is_liked: isLiked
                    })
                })
                .then(response => {
                    if (!response.ok) {
                        return response.json().then(err => {
                            throw new Error(err.error || 'Network response was not ok');
                        });
                    }
                    return response.json();
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }


        // Function to switch settings content
        function switchSettingsContent(selectedTab) {
            // Hide all content sections
            console.log("Switching to tab: ", selectedTab);
            const contentSections = document.querySelectorAll('.settings-content');
            contentSections.forEach(section => {
                section.style.display = 'none';
            });

            // Show the selected content section
            const selectedContent = document.querySelector(`[data-content="${selectedTab}"]`);
            if (selectedContent) {
                selectedContent.style.display = 'block';
            }
        }

        // Attach click event listeners to sidebar tabs
        document.querySelectorAll('.settings-sidebar-tab').forEach(tab => {
            tab.addEventListener('click', function() {
                console.log("Tab clicked"); // Debugging line
                const selectedTab = this.getAttribute('data-tab');
                switchSettingsContent(selectedTab);
            });
        });


        document.addEventListener('keydown', closeSettingsWithEsc);

        document.getElementById('likeBtn').addEventListener('click', function() {
            toggleActiveState(this, document.getElementById('dislikeBtn'));
            sendFeedback(currentResponseID, true);
        });

        document.getElementById('dislikeBtn').addEventListener('click', function() {
            toggleActiveState(this, document.getElementById('likeBtn'));
            sendFeedback(currentResponseID, false);
        });
    </script>
</body>

</html>